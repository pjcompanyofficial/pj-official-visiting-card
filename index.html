<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Scanner Search — Prototype</title>  <!-- Minimal reset + Google font -->  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.12);
      --accent: #7c3aed; /* purple */
      --muted: rgba(255,255,255,0.6);
      color-scheme: dark;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0f172a 0%, #071024 100%);-webkit-font-smoothing:antialiased;color:#e6eef8}
    .app{max-width:1100px;margin:28px auto;padding:22px}

    /* header */
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .brand{font-weight:700;font-size:18px}
    .controls{margin-left:auto;display:flex;align-items:center;gap:10px}

    /* glass card */
    .card{backdrop-filter: blur(10px);background:var(--glass-bg);border:1px solid var(--glass-border);padding:16px;border-radius:14px}

    /* search area */
    .search-row{display:flex;gap:12px;align-items:center}
    .search{flex:1;display:flex;gap:8px}
    .search input{flex:1;padding:12px 14px;border-radius:12px;border:none;background:rgba(255,255,255,0.03);color:inherit;font-size:15px}
    .search button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#5b21b6);color:white;font-weight:600}

    /* categories */
    .cats{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);cursor:pointer;font-size:14px}
    .chip.active{background:linear-gradient(90deg,var(--accent),#5b21b6);color:white}

    /* results */
    .results{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .result{padding:12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04)}
    .result h4{margin:0 0 6px 0;font-size:15px}
    .result p{margin:0;font-size:13px;color:var(--muted)}

    /* three-dot menu */
    .menu{position:relative}
    .menu-btn{background:none;border:0;color:inherit;font-size:20px;padding:8px;border-radius:8px}
    .menu-pop{position:absolute;right:0;top:38px;background:var(--glass-bg);border:1px solid var(--glass-border);padding:10px;border-radius:10px;min-width:220px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .menu-pop label{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .tiny{font-size:12px;color:var(--muted)}

    /* scanner area */
    .scanner{margin-top:14px;display:flex;gap:12px;flex-wrap:wrap}
    .scanner button{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

    footer{margin-top:22px;font-size:12px;color:var(--muted)}

    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center}
    .modal{width:360px;max-width:94%;background:#061226;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.06)}
    .modal input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);margin-top:8px;background:transparent;color:inherit}

    @media (max-width:600px){.search-row{flex-direction:column;align-items:stretch}.controls{margin-left:0}}
  </style></head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#0b1220"/><path d="M6 12h12M6 7h12M6 17h12" stroke="#7c3aed" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <div>
          <div class="brand">Scanner Search</div>
          <div class="tiny">AI-powered multi-source search prototype</div>
        </div>
      </div><div class="controls">
    <div class="tiny id-status">Safe mode: <strong id="safeModeText">ON</strong></div>
    <div class="menu card" style="padding:6px">
      <button class="menu-btn" id="menuBtn">⋮</button>
      <div class="menu-pop" id="menuPop" style="display:none">
        <div style="margin-bottom:8px"><strong>Settings</strong></div>
        <label>Safe Search <input type="checkbox" id="safeSearch" checked></label>
        <label>Allow 18+ Section <input type="checkbox" id="allow18"></label>
        <div class="tiny" style="margin-top:8px">Enable sensitive 18+ results only after age verification.</div>
      </div>
    </div>
  </div>
</header>

<section class="card">
  <div class="search-row">
    <div class="search">
      <input id="q" placeholder="Search anything — photos, videos, links, docs, shopping, maps..." autofocus>
      <button id="searchBtn">Search</button>
    </div>

    <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
      <div class="scanner">
        <button id="scanQr">Scan QR/Barcode</button>
        <label style="display:inline-block">
          <input id="uploadImg" type="file" accept="image/*" style="display:none">
          <button type="button">Upload Image</button>
        </label>
      </div>
    </div>
  </div>

  <div class="cats" id="cats">
    <div class="chip active" data-type="all">All</div>
    <div class="chip" data-type="images">Images</div>
    <div class="chip" data-type="videos">Videos</div>
    <div class="chip" data-type="shopping">Shopping</div>
    <div class="chip" data-type="maps">Maps</div>
  </div>

  <div class="results" id="results">
    <!-- results appended here -->
  </div>

  <div style="margin-top:10px" class="tiny">Tip: This prototype performs client-side interactions and expects a server-side proxy that calls the AI & web search (Gemini) APIs. See comments in JS for implementation notes.</div>
</section>

<footer class="tiny">Built for demo — do not expose API keys in client. Age verification required for 18+ content.</footer>

  </div>  <!-- Age verification modal -->  <div id="ageModal" style="display:none" class="modal-back">
    <div class="modal">
      <h3>Age verification</h3>
      <p class="tiny">To enable the 18+ section you must confirm that you're 18 years or older. Enter your birthdate.</p>
      <input type="date" id="birthdate">
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button id="ageCancel">Cancel</button>
        <button id="ageConfirm">Confirm</button>
      </div>
    </div>
  </div>  <!-- Libraries (optional): Tesseract for in-browser OCR -->  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>  <script>
    /* ====== Prototype client-side logic ======
       IMPORTANT: This is a frontend-only prototype. To get real web results (including Gemini API),
       implement a server-side endpoint that does the following:
         1) Accepts query, category, safe_search, include_sensitive flags from client.
         2) Authenticates to the Gemini API (or Google Custom Search / other engines) on server-side.
         3) Requests real-time web results, processes/filters them as needed and returns JSON to the client.
       NEVER put your API keys or direct calls to Gemini into client-side JS; use a secure backend.
    */

    const menuBtn = document.getElementById('menuBtn');
    const menuPop = document.getElementById('menuPop');
    const safeSearch = document.getElementById('safeSearch');
    const allow18 = document.getElementById('allow18');
    const safeModeText = document.getElementById('safeModeText');
    const menu = document.querySelector('.menu');
    const cats = document.getElementById('cats');
    const qInput = document.getElementById('q');
    const searchBtn = document.getElementById('searchBtn');
    const results = document.getElementById('results');
    const uploadImg = document.getElementById('uploadImg');
    const scanQr = document.getElementById('scanQr');

    // menu toggle
    menuBtn.addEventListener('click', ()=>{menuPop.style.display = menuPop.style.display==='none'?'block':'none'});

    // update safe-mode text
    function updateSafeText(){safeModeText.textContent = safeSearch.checked? 'ON' : 'OFF'}
    safeSearch.addEventListener('change', updateSafeText);
    updateSafeText();

    // Age verification modal flow for enabling 18+
    const ageModal = document.getElementById('ageModal');
    const birthdate = document.getElementById('birthdate');
    const ageConfirm = document.getElementById('ageConfirm');
    const ageCancel = document.getElementById('ageCancel');

    allow18.addEventListener('change',(e)=>{
      if(allow18.checked){
        // open age modal
        ageModal.style.display='flex';
      } else {
        // disabled by user
      }
    });
    ageCancel.addEventListener('click',()=>{allow18.checked=false;ageModal.style.display='none'});
    ageConfirm.addEventListener('click',()=>{
      const bd = birthdate.value;
      if(!bd){alert('Enter birthdate.');return}
      const age = getAge(new Date(bd));
      if(age>=18){
        ageModal.style.display='none';
        alert('Age verified — 18+ section enabled.');
      } else {
        alert('You must be 18 or older to enable this.');
        allow18.checked=false;ageModal.style.display='none';
      }
    });
    function getAge(dob){
      const diff = Date.now() - dob.getTime();
      const ageDt = new Date(diff);
      return Math.abs(ageDt.getUTCFullYear() - 1970);
    }

    // category click
    cats.addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip');
      if(!chip) return;
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      chip.classList.add('active');
    });

    // simple debounce
    function debounce(fn,delay=350){let t;return (...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),delay)}}

    // perform search (prototyped)
    async function performSearch(){
      const q = qInput.value.trim();
      if(!q) return;results.innerHTML = '<div class="tiny">Searching... (prototype client demo)</div>';
      const category = document.querySelector('.chip.active').dataset.type;
      const params = {
        q,category,safe_search:safeSearch.checked,include_sensitive:allow18.checked
      };

      // DEMO: We show mock data locally. Replace the fetch below with a secure server endpoint.
      // Example server call (server must contact Gemini + web index):
      // fetch('/api/search', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(params)})
      //   .then(r=>r.json()).then(renderResults)

      // Mock results to show structure
      const mock = generateMockResults(q,category);
      setTimeout(()=>renderResults(mock),450);
    }

    const debSearch = debounce(performSearch, 450);
    qInput.addEventListener('input', debSearch);
    searchBtn.addEventListener('click', performSearch);

    function renderResults(items){
      results.innerHTML='';
      if(!items || items.length===0){results.innerHTML='<div class="tiny">No results</div>';return}
      items.forEach(it=>{
        const el = document.createElement('div');el.className='result';
        el.innerHTML = `<h4>${escapeHtml(it.title)}</h4><p>${escapeHtml(it.snippet)}</p><div class="tiny" style="margin-top:8px">Source: ${escapeHtml(it.source)} • ${escapeHtml(it.type)}</div>`;
        results.appendChild(el);
      });
    }

    function escapeHtml(s){return (s+'').replace(/[&<>"'`]/g,function(c){return{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"`":'&#96;'}[c]})}

    function generateMockResults(q,cat){
      const t = [];
      for(let i=1;i<=8;i++){
        t.push({title:`Result ${i} — ${q}` , snippet:`Snippet for ${q} in category ${cat}. Click to preview.`, source:'example.com',type:cat});
      }
      return t;
    }

    /* ====== Image upload -> OCR sample (Tesseract) ====== */
    uploadImg.addEventListener('change', async (ev)=>{
      const f = ev.target.files && ev.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      results.innerHTML = '<div class="tiny">Running OCR on uploaded image...</div>';
      try{
        const worker = Tesseract.createWorker();
        await worker.load();
        await worker.loadLanguage('eng');
        await worker.initialize('eng');
        const {data:{text}} = await worker.recognize(url);
        await worker.terminate();
        qInput.value = text.trim().slice(0,500);
        performSearch();
      }catch(e){console.error(e);alert('OCR failed: '+e.message)}
    });

    /* ====== QR / Barcode scanning using BarcodeDetector (if available) ====== */
    scanQr.addEventListener('click', async ()=>{
      if(!('BarcodeDetector' in window)){
        alert('BarcodeDetector API not available in this browser. Use a modern Chrome/Edge or upload an image.');
        return;
      }
      // open camera stream and detect
      try{
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        const track = stream.getVideoTracks()[0];
        const video = document.createElement('video');video.srcObject = stream;video.playsInline=true;video.muted=true;await video.play();
        const detector = new BarcodeDetector({formats: ['qr_code','ean_13','code_128']});
        results.innerHTML = '';
        const wrap = document.createElement('div');wrap.className='result';wrap.innerHTML='<div class="tiny">Point camera at a barcode/QR code...</div>';results.appendChild(wrap);
        const scanLoop = async ()=>{
          try{
            const detections = await detector.detect(video);
            if(detections && detections.length){
              const d = detections[0];
              qInput.value = d.rawValue || d.raw_text || d.displayValue || '';
              stream.getTracks().forEach(t=>t.stop());
              performSearch();
              return;
            }
          }catch(err){console.error(err)}
          requestAnimationFrame(scanLoop);
        };
        scanLoop();
      }catch(e){console.error(e);alert('Camera access denied or unavailable.')}
    });

    /* ====== CAVEATS & HOW TO CONNECT TO GEMINI ======
       - Google Gemini (and similar AI models) commonly require server-side integration.
       - Set up a small Node/Express (or Python/Flask) endpoint that receives client queries and performs the
         following steps securely on the server:
           1) Validate + rate-limit incoming requests.
           2) Attach your server-side API key and call the Gemini or search APIs.
           3) Post-process results (apply safe search filters, transform into JSON, remove PII).
           4) Return results to the client.
       - Example server JSON contract (POST /api/search) -> {query,category,safe_search,include_sensitive}
       - Server should never return raw HTML that contains active scripts; prefer sanitized search results.
    */

    /* Small UX nicety: press Enter to search */
    qInput.addEventListener('keydown', (e)=>{if(e.key==='Enter'){performSearch()}});

    /* End of prototype script */
  </script></body>
</html>
